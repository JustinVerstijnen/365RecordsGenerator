<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Microsoft 365 DNS Record Generator</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f7f8fb;
    color: #222;
    margin: 0;
    padding: 2rem 1rem;
    display: flex;
    justify-content: center;
  }
  main {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgb(0 0 0 / 0.1);
    max-width: 900px;
    width: 100%;
    padding: 2rem 2.5rem;
  }
  header {
    text-align: center;
    margin-bottom: 1.5rem;
  }
  header img {
    width: 50px;
    height: 50px;
    object-fit: contain;
    margin-bottom: 0.5rem;
  }
  h1, h2 {
    color: #8EAFDA;
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.75rem;
  }
  h1 {
    font-size: 1.75rem;
    margin-top: 0;
  }
  label {
    display: block;
    font-weight: 600;
    margin-top: 1.2rem;
    margin-bottom: 0.3rem;
    color: #444;
  }
  input[type="text"],
  input[type="email"],
  input[type="date"],
  select {
    width: 100%;
    padding: 0.65rem 1rem;
    font-size: 1rem;
    border: 1.5px solid #d1d9e6;
    border-radius: 8px;
    transition: border-color 0.2s ease;
    box-sizing: border-box;
  }
  input[type="text"]:focus,
  input[type="email"]:focus,
  input[type="date"]:focus,
  select:focus {
    outline: none;
    border-color: #8EAFDA;
    box-shadow: 0 0 6px #a7c7f9;
  }
  button, .customize-toggle-btn {
    font-weight: 600;
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.2s ease;
  }
  button {
    margin-top: 2rem;
    width: 100%;
    background-color: #8EAFDA;
    border: none;
    color: white;
    font-size: 1.1rem;
    padding: 0.85rem;
  }
  button:hover {
    background-color: #6b8ec6;
  }
  .customize-toggle-btn {
    margin-top: 1.5rem;
    background-color: #f9c74f;
    color: #444;
    border: 2px solid #f9c74f;
    padding: 0.5rem 1rem;
    width: auto;
    display: inline-block;
  }
  .customize-toggle-btn:hover {
    background-color: #e0b732;
    color: #222;
    border-color: #e0b732;
  }
  #customizeSection {
    margin-top: 1rem;
    display: none;
  }
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 8px;
    margin-top: 0.75rem;
  }
  th, td {
    padding: 0.65rem 1rem;
    text-align: left;
    vertical-align: middle;
    word-break: break-word;
  }
  th {
    font-weight: 600;
    color: #555;
    background: #f0f3f7;
    border-radius: 8px;
  }
  tbody tr {
    background: #f9fbff;
    box-shadow: 0 1px 3px rgb(0 0 0 / 0.05);
    border-radius: 8px;
  }
  tbody tr td:first-child {
    border-top-left-radius: 8px;
    border-bottom-left-radius: 8px;
  }
  tbody tr td:last-child {
    border-top-right-radius: 8px;
    border-bottom-right-radius: 8px;
  }
  code {
    font-family: 'Courier New', Courier, monospace;
    background: #e8f0fe;
    padding: 0.2rem 0.4rem;
    border-radius: 5px;
    display: block;
    max-width: 100%;
    white-space: normal;
    word-wrap: break-word;
  }
  .copy-btn {
    cursor: pointer;
    background: #8EAFDA;
    border: none;
    color: white;
    font-weight: 600;
    padding: 0.3rem 0.7rem;
    border-radius: 6px;
    transition: background-color 0.2s ease;
  }
  .copy-btn:hover {
    background: #6b8ec6;
  }
  .inline-inputs {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .inline-inputs > div {
    flex: 1;
    min-width: 200px;
  }
  @media (max-width: 600px) {
    main {
      padding: 1rem 1rem;
    }
    .inline-inputs {
      flex-direction: column;
    }
  }
  .mode-toggle {
    margin-top: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  .mode-toggle label {
    font-weight: 600;
    color: #444;
    cursor: pointer;
  }
  .mode-toggle input[type="radio"] {
    margin-right: 0.3rem;
    cursor: pointer;
  }
</style>
</head>
<body>
<main>
  <header>
    <a href="https://justinverstijnen.nl" target="_blank" rel="noopener noreferrer" title="Go to justinverstijnen.nl">
      <img src="https://justinverstijnen.nl/wp-content/uploads/2025/04/cropped-Logo-2.0-Transparant.png" alt="Justin Verstijnen Logo" />
    </a>
    <h1>Microsoft 365 DNS Record Generator</h1>
  </header>

  <label for="defaultDomain">Default domain (e.g. yourname.onmicrosoft.com):</label>
  <input type="text" id="defaultDomain" placeholder="example.onmicrosoft.com" />

  <label for="customDomain">Custom domain (e.g. yourdomain.com):</label>
  <input type="text" id="customDomain" placeholder="example.com" />

  <div class="mode-toggle" aria-label="Select display mode">
    <label><input type="radio" name="mode" value="extended" checked /> Extended</label>
    <label><input type="radio" name="mode" value="simple" /> Simple</label>
  </div>

  <button id="toggleCustomize" class="customize-toggle-btn" aria-expanded="false" aria-controls="customizeSection">Customize</button>

  <section id="customizeSection" aria-hidden="true">
    <h2>DMARC Settings</h2>
    <div class="inline-inputs">
      <div>
        <label for="dmarcRUA">RUA Email (aggregate reports):</label>
        <input type="email" id="dmarcRUA" placeholder="mailto:admin@example.com" />
      </div>
      <div>
        <label for="dmarcRUF">RUF Email (forensic reports):</label>
        <input type="email" id="dmarcRUF" placeholder="mailto:admin@example.com" />
      </div>
      <div style="flex: 1; min-width: 150px;">
        <label for="dmarcPolicy">DMARC Policy:</label>
        <select id="dmarcPolicy">
          <option value="reject" selected>Reject</option>
          <option value="quarantine">Quarantine</option>
          <option value="none">None</option>
        </select>
      </div>
    </div>

    <h2>MTA-STS Settings</h2>
    <label for="mtaStsDate">Select date for MTA-STS id:</label>
    <input type="date" id="mtaStsDate" />
  </section>

  <button id="generateBtn">Generate Records</button>

  <div id="results" tabindex="0"></div>
</main>

<script>
  const toggleBtn = document.getElementById('toggleCustomize');
  const customizeSection = document.getElementById('customizeSection');
  const resultsDiv = document.getElementById('results');
  const modeRadios = document.querySelectorAll('input[name="mode"]');

  toggleBtn.addEventListener('click', () => {
    const isHidden = customizeSection.style.display === 'none' || customizeSection.style.display === '';
    customizeSection.style.display = isHidden ? 'block' : 'none';
    customizeSection.setAttribute('aria-hidden', !isHidden);
    toggleBtn.setAttribute('aria-expanded', isHidden);
    toggleBtn.textContent = isHidden ? 'Hide Customize' : 'Customize';
  });

  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, c => ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
    })[c]);
  }

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(() => {
      alert('Copied to clipboard!');
    });
  }

  function formatDate(date) {
    if (!date) return '';
    const d = new Date(date);
    return d.getUTCFullYear().toString().padStart(4, '0') +
      (d.getUTCMonth() + 1).toString().padStart(2, '0') +
      d.getUTCDate().toString().padStart(2, '0') + 'T000000Z';
  }

  function getSelectedMode() {
    for (const radio of modeRadios) {
      if (radio.checked) return radio.value;
    }
    return 'extended';
  }

  document.getElementById('generateBtn').addEventListener('click', () => {
    const defaultDomain = document.getElementById('defaultDomain').value.trim();
    const customDomain = document.getElementById('customDomain').value.trim();
    const dmarcRUA = document.getElementById('dmarcRUA').value.trim();
    const dmarcRUF = document.getElementById('dmarcRUF').value.trim();
    const dmarcPolicy = document.getElementById('dmarcPolicy').value;
    const mtaStsDateInput = document.getElementById('mtaStsDate').value;

    if (!defaultDomain || !customDomain) {
      alert('Please fill in both Default domain and Custom domain.');
      return;
    }

    const dkim1 = `selector1-${customDomain.replace(/\./g, '-')}._domainkey.${defaultDomain}`;
    const dkim2 = `selector2-${customDomain.replace(/\./g, '-')}._domainkey.${defaultDomain}`;

    const mxValue = `${customDomain}.mail.protection.outlook.com`;

    const mtaStsIdDate = mtaStsDateInput ? formatDate(mtaStsDateInput) : formatDate(new Date());

    let dmarcValue = `v=DMARC1; p=${dmarcPolicy};`;
    if (dmarcRUA) dmarcValue += ` rua=${dmarcRUA};`;
    if (dmarcRUF) dmarcValue += ` ruf=${dmarcRUF};`;

    const records = {
      "DKIM Records": [
        { name: "selector1._domainkey", ttl: "3600", record: dkim1 },
        { name: "selector2._domainkey", ttl: "3600", record: dkim2 },
      ],
      "MX Record": [
        { name: "@", type: "MX", priority: "0", value: mxValue }
      ],
      "Autodiscover Record": [
        { name: "autodiscover", type: "CNAME", value: "autodiscover.outlook.com" }
      ],
      "SPF Record": [
        { name: "@", type: "TXT", value: "v=spf1 include:spf.protection.outlook.com -all" }
      ],
      "DMARC Record": [
        { name: "_dmarc", type: "TXT", value: dmarcValue }
      ],
      "MTA-STS Record": [
        { name: "_mta-sts", type: "TXT", value: `v=STSv1; id=${mtaStsIdDate}` }
      ]
    };

    const mode = getSelectedMode();

    if (mode === 'simple') {
      resultsDiv.classList.add('simple');
      let simpleHtml = '<ul style="list-style:none; padding-left:0;">';
      for (const recs of Object.values(records)) {
        recs.forEach(rec => {
          let type = rec.type || (rec.record ? "DKIM" : "TXT");
          let value = rec.record || rec.value || "";
          simpleHtml += `<li>${escapeHtml(type)}: ${escapeHtml(value)}</li>`;
        });
      }
      simpleHtml += '</ul>';
      resultsDiv.innerHTML = simpleHtml;
    } else {
      resultsDiv.classList.remove('simple');
      let html = '';

      for (const [section, recs] of Object.entries(records)) {
        html += `<h2>${section}</h2><table><thead><tr>`;
        if (section === "DKIM Records") {
          html += `<th>Name</th><th>TTL</th><th>Record</th><th>Copy</th>`;
        } else if (section === "MX Record") {
          html += `<th>Name</th><th>Type</th><th>Priority</th><th>Value</th><th>Copy</th>`;
        } else {
          html += `<th>Name</th><th>Type</th><th>Value</th><th>Copy</th>`;
        }
        html += `</tr></thead><tbody>`;

        recs.forEach(rec => {
          html += `<tr>`;
          if (section === "DKIM Records") {
            html += `<td>${escapeHtml(rec.name)}</td><td>${escapeHtml(rec.ttl)}</td><td><code>${escapeHtml(rec.record)}</code></td>`;
            html += `<td><button class="copy-btn" onclick="copyToClipboard('${escapeHtml(rec.record)}')">Copy</button></td>`;
          } else if (section === "MX Record") {
            html += `<td>${escapeHtml(rec.name)}</td><td>${escapeHtml(rec.type)}</td><td>${escapeHtml(rec.priority)}</td><td><code>${escapeHtml(rec.value)}</code></td>`;
            html += `<td><button class="copy-btn" onclick="copyToClipboard('${escapeHtml(rec.value)}')">Copy</button></td>`;
          } else {
            html += `<td>${escapeHtml(rec.name)}</td><td>${escapeHtml(rec.type)}</td><td><code>${escapeHtml(rec.value)}</code></td>`;
            html += `<td><button class="copy-btn" onclick="copyToClipboard('${escapeHtml(rec.value)}')">Copy</button></td>`;
          }
          html += `</tr>`;
        });

        html += `</tbody></table>`;
      }

      resultsDiv.innerHTML = html;
    }

    resultsDiv.focus();
  });
</script>
</body>
</html>
