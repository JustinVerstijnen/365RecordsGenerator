<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Microsoft 365 DNS Record Generator</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f7f8fb;
    color: #222;
    margin: 0;
    padding: 2rem 1rem;
    display: flex;
    justify-content: center;
  }
  main {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 16px rgb(0 0 0 / 0.1);
    max-width: 900px;
    width: 100%;
    padding: 1.25rem 1.5rem;
    font-size: 14px;
    box-sizing: border-box;
    margin: 0 auto;
  }
  header {
    text-align: center;
    margin-bottom: 1rem;
  }
  header img {
    width: 50px;
    height: 50px;
    object-fit: contain;
    margin-bottom: 0.5rem;
  }
  h1, h2 {
    color: #8EAFDA;
    font-weight: 600;
    margin-top: 1rem;
    margin-bottom: 0.5rem;
  }
  h1 {
    font-size: 1.5rem;
    margin-top: 0;
  }
  #customizeSection h2 {
    font-size: 0.95rem;
    margin-top: 1.25rem;
    margin-bottom: 0.5rem;
  }
  .description {
    font-size: 1rem;
    color: #555;
    margin-top: 0;
    margin-bottom: 1rem;
  }
  label {
    display: block;
    font-weight: 600;
    margin-top: 1rem;
    margin-bottom: 0.25rem;
    color: #444;
  }
  input[type="text"],
  input[type="email"],
  input[type="date"],
  select {
    width: 100%;
    padding: 0.5rem 0.75rem;
    font-size: 0.9rem;
    border: 1.5px solid #d1d9e6;
    border-radius: 8px;
    transition: border-color 0.2s ease;
    box-sizing: border-box;
  }
  input[type="text"]:focus,
  input[type="email"]:focus,
  input[type="date"]:focus,
  select:focus {
    outline: none;
    border-color: #8EAFDA;
    box-shadow: 0 0 5px #a7c7f9;
  }
  button, .customize-toggle-btn {
    font-weight: 600;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 0.6rem 1rem;
    border: none;
  }
  button {
    margin-top: 1.5rem;
    width: 100%;
    background-color: #8EAFDA;
    color: white;
    font-size: 1rem;
  }
  button:hover {
    background-color: #6b8ec6;
  }
  .customize-toggle-btn {
    margin-top: 1rem;
    background-color: #f9c74f;
    color: #444;
    border: 2px solid #f9c74f;
    width: auto;
  }
  .customize-toggle-btn:hover {
    background-color: #e0b732;
    color: #222;
    border-color: #e0b732;
  }
  #customizeSection {
    margin-top: 0.75rem;
    display: none;
  }
  table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0 6px;
    margin-top: 0.5rem;
    table-layout: fixed;
  }
  th, td {
    padding: 0.4rem 0.7rem;
    text-align: left;
    vertical-align: middle;
    word-break: break-word;
    font-size: 13px;
    overflow-wrap: anywhere;
  }
  th {
    font-weight: 600;
    color: #555;
    background: #f0f3f7;
    border-radius: 6px;
  }
  tbody tr {
    background: #f9fbff;
    box-shadow: 0 1px 3px rgb(0 0 0 / 0.05);
    border-radius: 6px;
  }
  tbody tr td:first-child {
    border-top-left-radius: 6px;
    border-bottom-left-radius: 6px;
  }
  tbody tr td:last-child {
    border-top-right-radius: 6px;
    border-bottom-right-radius: 6px;
  }
  /* Fixed column widths */
  th:nth-child(1), td:nth-child(1) { width: 12%; white-space: nowrap; }
  th:nth-child(2), td:nth-child(2) { width: 18%; white-space: nowrap; }
  th:nth-child(3), td:nth-child(3) {
    width: 58%;
    font-family: 'Courier New', Courier, monospace;
    white-space: normal;
    word-wrap: break-word;
    background: #f9fbff;
    padding: 0.4rem 0.7rem;
  }
  th:nth-child(4), td:nth-child(4) {
    width: 12%;
    text-align: center;
    vertical-align: middle;
    padding: 0.4rem 0.7rem;
  }
  td:last-child {
    vertical-align: middle;
    text-align: center;
    padding: 0.4rem 0.7rem;
  }
  code {
    font-family: 'Courier New', Courier, monospace;
    background: none !important;
    padding: 0 !important;
    display: inline !important;
    border-radius: 0 !important;
    font-size: 13px;
    white-space: normal;
    word-wrap: break-word;
  }
  .copy-btn {
    width: 48px;
    height: 24px;
    font-size: 13px;
    padding: 0;
    border-radius: 6px;
    background: #8EAFDA;
    color: white;
    font-weight: 600;
    cursor: pointer;
    display: block;
    margin: 0 auto;
    transition: background-color 0.2s ease;
    border: none;
  }
  .copy-btn:hover {
    background: #6b8ec6;
  }
  .inline-inputs {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
  }
  .inline-inputs > div {
    flex: 1;
    min-width: 180px;
  }
  fieldset {
    margin-top: 1rem;
    border: none;
    padding: 0;
  }
  fieldset legend {
    font-weight: 600;
    color: #444;
    margin-bottom: 0.5rem;
  }
  .spf-options {
    display: flex;
    gap: 1.5rem;
  }
  .spf-options label {
    display: flex;
    align-items: center;
    gap: 0.3rem;
    cursor: pointer;
  }
  @media (max-width: 600px) {
    main {
      padding: 1rem 1rem;
    }
    .inline-inputs {
      flex-direction: column;
    }
    .spf-options {
      flex-direction: column;
    }
  }
  .mode-toggle {
    margin-top: 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
  }
  .mode-toggle label {
    font-weight: 600;
    color: #444;
    cursor: pointer;
  }
  .mode-toggle input[type="radio"] {
    margin-right: 0.3rem;
    cursor: pointer;
  }
  #results.simple {
    white-space: pre-wrap;
    font-family: monospace;
    margin-top: 1rem;
    font-size: 14px;
  }
  /* Icon styles for buttons */
  svg.icon {
    width: 16px;
    height: 16px;
    fill: currentColor;
  }
</style>
</head>
<body>
<main>
  <header>
    <a href="https://justinverstijnen.nl" target="_blank" rel="noopener noreferrer" title="Go to justinverstijnen.nl">
      <img src="https://justinverstijnen.nl/wp-content/uploads/2025/04/cropped-Logo-2.0-Transparant.png" alt="Justin Verstijnen Logo" />
    </a>
    <h1>Microsoft 365 DNS Record Generator</h1>
  </header>

  <p class="description">
    Quickly generate Microsoft 365 DNS records for your custom domains including MX, SPF, DKIM, DMARC, and MTA-STS. Customize advanced settings and export your records.
  </p>

  <label for="defaultDomain">Default domain (e.g. yourname.onmicrosoft.com):</label>
  <input type="text" id="defaultDomain" placeholder="example.onmicrosoft.com" />

  <label for="customDomain">Custom domain (e.g. yourdomain.com):</label>
  <input type="text" id="customDomain" placeholder="example.com" />

  <div class="mode-toggle" aria-label="Select display mode">
    <label><input type="radio" name="mode" value="extended" checked /> Extended</label>
    <label><input type="radio" name="mode" value="simple" /> Simple</label>
  </div>

  <button id="toggleCustomize" class="customize-toggle-btn" aria-expanded="false" aria-controls="customizeSection" type="button">
    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 15.5l-7-7 1.41-1.41L12 12.67l5.59-5.58L19 8.5z"/></svg>
    Customize
  </button>

  <section id="customizeSection" aria-hidden="true">
    <h2>DMARC Settings</h2>
    <div class="inline-inputs">
      <div>
        <label for="dmarcRUA">RUA Email (aggregate reports):</label>
        <input type="email" id="dmarcRUA" placeholder="admin@example.com" />
      </div>
      <div>
        <label for="dmarcRUF">RUF Email (forensic reports):</label>
        <input type="email" id="dmarcRUF" placeholder="admin@example.com" />
      </div>
      <div style="flex: 1; min-width: 150px;">
        <label for="dmarcPolicy">DMARC Policy:</label>
        <select id="dmarcPolicy">
          <option value="reject" selected>Reject</option>
          <option value="quarantine">Quarantine</option>
          <option value="none">None</option>
        </select>
      </div>
    </div>

    <h2>MTA-STS Settings</h2>
    <div class="inline-inputs">
      <div>
        <label for="mtaStsDate">Select date for MTA-STS id:</label>
        <input type="date" id="mtaStsDate" />
      </div>
      <div>
        <label for="mtaStsEmail">MTA-STS Report Email (RUA):</label>
        <input type="email" id="mtaStsEmail" placeholder="admin@example.com" />
      </div>
    </div>

    <h2>SPF Settings</h2>
    <fieldset class="spf-options">
      <legend>SPF Fail Type:</legend>
      <label><input type="radio" name="spfFail" value="hard" checked /> Hardfail (-all)</label>
      <label><input type="radio" name="spfFail" value="soft" /> Softfail (~all)</label>
    </fieldset>
  </section>

  <button id="generateBtn" type="button">
    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M5 20h14v-2H5v2zm7-18l-5 5h3v6h4v-6h3l-5-5z"/></svg>
    Generate Records
  </button>

  <button id="exportBtn" type="button" style="display:none; background:#4CAF50; margin-top:0.5rem; width:100%;">
    <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M5 20h14v-2H5v2zm7-18l-5 5h3v6h4v-6h3l-5-5z"/></svg>
    Export to HTML
  </button>

  <pre id="results" tabindex="0"></pre>
</main>

<script>
  const toggleBtn = document.getElementById('toggleCustomize');
  const customizeSection = document.getElementById('customizeSection');
  const resultsDiv = document.getElementById('results');
  const modeRadios = document.querySelectorAll('input[name="mode"]');
  const spfFailRadios = document.querySelectorAll('input[name="spfFail"]');
  const exportBtn = document.getElementById('exportBtn');

  toggleBtn.addEventListener('click', () => {
    const isHidden = customizeSection.style.display === 'none' || customizeSection.style.display === '';
    customizeSection.style.display = isHidden ? 'block' : 'none';
    customizeSection.setAttribute('aria-hidden', !isHidden);
    toggleBtn.setAttribute('aria-expanded', isHidden);
    toggleBtn.textContent = (isHidden ? 'Hide Customize' : 'Customize');
    // Add icon back after text:
    if (isHidden) {
      toggleBtn.innerHTML = '<svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 15.5l-7-7 1.41-1.41L12 12.67l5.59-5.58L19 8.5z"/></svg> Hide Customize';
    } else {
      toggleBtn.innerHTML = '<svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 15.5l-7-7 1.41-1.41L12 12.67l5.59-5.58L19 8.5z"/></svg> Customize';
    }
  });

  function escapeHtml(text) {
    return text.replace(/[&<>"']/g, c => ({
      '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
    })[c]);
  }

  function isValidEmail(email) {
    const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return re.test(email);
  }

  function copyToClipboard(text) {
    navigator.clipboard.writeText(text);
    // no alert to keep silent copy
  }

  function formatDate(date) {
    if (!date) return '';
    const d = new Date(date);
    return d.getUTCFullYear().toString().padStart(4, '0') +
      (d.getUTCMonth() + 1).toString().padStart(2, '0') +
      d.getUTCDate().toString().padStart(2, '0') + 'T000000Z';
  }

  function getSelectedMode() {
    for (const radio of modeRadios) {
      if (radio.checked) return radio.value;
    }
    return 'extended';
  }

  function getSelectedSPFFail() {
    for (const radio of spfFailRadios) {
      if (radio.checked) return radio.value;
    }
    return 'hard';
  }

  const recordOrder = [
    "MX Record",
    "Autodiscover Record",
    "SPF Record",
    "DKIM Records",
    "DMARC Record",
    "MTA-STS Record"
  ];

  function generateRecords() {
    const defaultDomain = document.getElementById('defaultDomain').value.trim();
    const customDomain = document.getElementById('customDomain').value.trim();
    const dmarcRUA = document.getElementById('dmarcRUA').value.trim();
    const dmarcRUF = document.getElementById('dmarcRUF').value.trim();
    const dmarcPolicy = document.getElementById('dmarcPolicy').value;
    const mtaStsDateInput = document.getElementById('mtaStsDate').value;
    const mtaStsEmail = document.getElementById('mtaStsEmail').value.trim();
    const spfFailType = getSelectedSPFFail();

    if (!defaultDomain || !customDomain) {
      alert('Please fill in both Default domain and Custom domain.');
      return false;
    }

    if (dmarcRUA && !isValidEmail(dmarcRUA)) {
      alert('Please enter a valid RUA email address.');
      return false;
    }
    if (dmarcRUF && !isValidEmail(dmarcRUF)) {
      alert('Please enter a valid RUF email address.');
      return false;
    }
    if (mtaStsEmail && !isValidEmail(mtaStsEmail)) {
      alert('Please enter a valid MTA-STS Report email address.');
      return false;
    }

    const dkim1 = `selector1-${customDomain.replace(/\./g, '-')}._domainkey.${defaultDomain}`;
    const dkim2 = `selector2-${customDomain.replace(/\./g, '-')}._domainkey.${defaultDomain}`;

    const mxValue = `0 ${customDomain}.mail.protection.outlook.com`;

    const mtaStsIdDate = mtaStsDateInput ? formatDate(mtaStsDateInput) : formatDate(new Date());

    const spfValue = `v=spf1 include:spf.protection.outlook.com ${spfFailType === 'hard' ? '-all' : '~all'}`;

    let dmarcValue = `v=DMARC1; p=${dmarcPolicy};`;
    if (dmarcRUA) dmarcValue += ` rua=mailto:${dmarcRUA};`;
    if (dmarcRUF) dmarcValue += ` ruf=mailto:${dmarcRUF};`;

    let mtaStsValue = `v=STSv1; id=${mtaStsIdDate}`;
    if (mtaStsEmail) {
      mtaStsValue += `; rua=mailto:${mtaStsEmail}`;
    }

    const records = {
      "MX Record": [
        { name: "@", type: "MX", value: mxValue }
      ],
      "Autodiscover Record": [
        { name: "autodiscover", type: "CNAME", value: "autodiscover.outlook.com" }
      ],
      "SPF Record": [
        { name: "@", type: "TXT", value: spfValue }
      ],
      "DKIM Records": [
        { name: "selector1._domainkey", type: "CNAME", ttl: "3600", record: dkim1 },
        { name: "selector2._domainkey", type: "CNAME", ttl: "3600", record: dkim2 },
      ],
      "DMARC Record": [
        { name: "_dmarc", type: "TXT", value: dmarcValue }
      ],
      "MTA-STS Record": [
        { name: "_mta-sts", type: "TXT", value: mtaStsValue }
      ]
    };

    const mode = getSelectedMode();

    if (mode === 'simple') {
      resultsDiv.classList.add('simple');
      let simpleLines = [];
      for (const section of recordOrder) {
        const recs = records[section];
        if (!recs) continue;
        recs.forEach(rec => {
          const type = rec.type || (rec.record ? "CNAME" : "TXT");
          const hostname = rec.name;
          const value = rec.record || rec.value || "";
          // Use two spaces instead of tabs:
          simpleLines.push(`${type}  ${hostname}  ${value}`);
        });
      }
      resultsDiv.textContent = simpleLines.join('\n');
      exportBtn.style.display = 'none'; // Hide export in simple mode
    } else {
      resultsDiv.classList.remove('simple');
      let html = '';
      for (const section of recordOrder) {
        const recs = records[section];
        if (!recs) continue;
        html += `<h2>${section}</h2><table><thead><tr>
          <th>Type</th>
          <th>Name</th>
          <th>Value</th>
          <th>Copy</th>
        </tr></thead><tbody>`;
        if (section === "DKIM Records") {
          recs.forEach(rec => {
            html += `<tr>
              <td>CNAME</td>
              <td>${escapeHtml(rec.name)}</td>
              <td><code>${escapeHtml(rec.record)}</code></td>
              <td><button class="copy-btn" onclick="copyToClipboard('${escapeHtml(rec.record)}')" aria-label="Copy record">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                Copy
              </button></td>
            </tr>`;
          });
        } else {
          recs.forEach(rec => {
            html += `<tr>
              <td>${escapeHtml(rec.type)}</td>
              <td>${escapeHtml(rec.name)}</td>
              <td><code>${escapeHtml(rec.value)}</code></td>
              <td><button class="copy-btn" onclick="copyToClipboard('${escapeHtml(rec.value)}')" aria-label="Copy record">
                <svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
                Copy
              </button></td>
            </tr>`;
          });
        }
        html += `</tbody></table>`;
      }
      resultsDiv.innerHTML = html;
      exportBtn.style.display = 'inline-flex'; // Show export button in extended mode
    }

    // Close customize section on generate
    customizeSection.style.display = 'none';
    customizeSection.setAttribute('aria-hidden', 'true');
    toggleBtn.setAttribute('aria-expanded', 'false');
    toggleBtn.innerHTML = '<svg class="icon" viewBox="0 0 24 24" aria-hidden="true"><path d="M12 15.5l-7-7 1.41-1.41L12 12.67l5.59-5.58L19 8.5z"/></svg> Customize';

    resultsDiv.focus();
  }

  document.getElementById('generateBtn').addEventListener('click', generateRecords);

  exportBtn.addEventListener('click', () => {
    // Export the extended HTML results as a downloadable file
    const extendedHtml = resultsDiv.innerHTML;
    if (!extendedHtml) {
      alert('No records to export. Please generate records first.');
      return;
    }
    const blob = new Blob([`
      <!DOCTYPE html>
      <html lang="en">
      <head><meta charset="UTF-8"><title>Exported DNS Records</title>
      <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; padding: 1rem; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 1rem; }
        th, td { border: 1px solid #ddd; padding: 0.5rem; text-align: left; }
        th { background-color: #8EAFDA; color: white; }
        code { font-family: monospace; background: none; padding: 0; }
      </style>
      </head>
      <body>
      ${extendedHtml}
      </body>
      </html>
    `], {type: 'text/html'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'Microsoft365-DNS-Records.html';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
  });
</script>
</body>
</html>
